task setAntClassLoader {
  doLast {
    ClassLoader antClassLoader = org.apache.tools.ant.Project.class.classLoader
    configurations.runtime.each { File f ->
        antClassLoader.addURL(f.toURI().toURL())
    }
    antClassLoader.addURL(file('./resources/').toURI().toURL()) //testmodel_model.xml in the classpath
  }
}

ant.importBuild('build.xml') {
    antTargetName -> 'ant-' + antTargetName
}

sourceSets {
    main {
        java {
            srcDirs = ['build/gen/src']
        }
        resources {
            srcDirs = ['resources']
        }
    }
}

dependencies {
  compile project(':intermine-objectstore-main')
}

ant.properties['no.dep'] = 'true'
ant.properties['regenerate.java'] = 'true'
ant.properties['model.name'] = 'testmodel'
ant.properties['gen.src.dir'] = 'build/gen/src'

tasks.compileJava.dependsOn 'setAntClassLoader'
tasks.compileJava.dependsOn 'ant-generate'
tasks.'ant-generate'.mustRunAfter 'setAntClassLoader'
